{
  "comments": [
    {
      "key": {
        "uuid": "2e3f6ead_fa7f2e73",
        "filename": "src/SAL/state_lock.c",
        "patchSetId": 1
      },
      "lineNbr": 2268,
      "author": {
        "id": 1004087
      },
      "writtenOn": "2020-04-30T15:54:06Z",
      "side": 1,
      "message": "Is ESTALE a common error on a lock op?  It\u0027s not a valid return from lockf() or flock(), so I can\u0027t tell what it\u0027s supposed to mean.",
      "revId": "bb60d38ba540f0291d6c5e65be2964d5d89dd4c5",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0de59260_5b795be9",
        "filename": "src/SAL/state_lock.c",
        "patchSetId": 1
      },
      "lineNbr": 2268,
      "author": {
        "id": 1003571
      },
      "writtenOn": "2020-05-01T14:29:27Z",
      "side": 1,
      "message": "Yea, I\u0027m wondering why this is necessary. More description in the commit message of why ESTALE needs special handling. And maybe a comment here.\n\nAlso is it appropriate for this to just be an event?",
      "parentUuid": "2e3f6ead_fa7f2e73",
      "revId": "bb60d38ba540f0291d6c5e65be2964d5d89dd4c5",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cc2e8276_fdbd1df2",
        "filename": "src/SAL/state_lock.c",
        "patchSetId": 1
      },
      "lineNbr": 2268,
      "author": {
        "id": 1003947
      },
      "writtenOn": "2020-05-03T13:44:21Z",
      "side": 1,
      "message": "Not a common thing, but one client trying to place a lock while another one deleting the same file should cause this error. If a simple application can cause this, I would think LogMaj() is a wrong thing to do, correct?",
      "parentUuid": "0de59260_5b795be9",
      "revId": "bb60d38ba540f0291d6c5e65be2964d5d89dd4c5",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cbb8b848_c33d9fe4",
        "filename": "src/SAL/state_lock.c",
        "patchSetId": 1
      },
      "lineNbr": 2268,
      "author": {
        "id": 1004087
      },
      "writtenOn": "2020-05-04T14:05:13Z",
      "side": 1,
      "message": "Okay.  But in that case, we probably don\u0027t want to rate limit it.",
      "parentUuid": "cc2e8276_fdbd1df2",
      "revId": "bb60d38ba540f0291d6c5e65be2964d5d89dd4c5",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "078b1b14_dce80c0d",
        "filename": "src/SAL/state_lock.c",
        "patchSetId": 1
      },
      "lineNbr": 2268,
      "author": {
        "id": 1003571
      },
      "writtenOn": "2020-05-04T14:24:16Z",
      "side": 1,
      "message": "Hmm, thinking more, if ESTALE is a natural result of calling lock_op on an entry being deleted, we shouldn\u0027t even log at the event level, it should be a LogDebug and I don\u0027t think it should be rate limited.\n\nIn any case, a break is necessary or in addition to whatever you log, you will also do the LogMajor...",
      "parentUuid": "cbb8b848_c33d9fe4",
      "revId": "bb60d38ba540f0291d6c5e65be2964d5d89dd4c5",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55e64a4a_6aff3d35",
        "filename": "src/SAL/state_lock.c",
        "patchSetId": 1
      },
      "lineNbr": 2268,
      "author": {
        "id": 1008177
      },
      "writtenOn": "2020-05-06T12:03:31Z",
      "side": 1,
      "message": "background about this change: a customer has different kind of workload, their NFS clients do add and remove of files frequently. They see ESTALEs for NFSv4 file open, getattrs and LOCK requests. Their logs show lots of \"state_test :STATE :MAJ :Got error from FSAL lock operation, error\u003dSTATE_ESTALE\" and \"state_lock :STATE :MAJ :Unable to lock FSAL, error\u003dSTATE_ESTALE\" trace\nSo had made the trace as LogEventLimited(..) for ESTALE error. A reason to have it as EVENT was because had observed that in fsal_common_is_referral(..) if ESTALE (or any other error) is returned by getattrs() then we are reporting the error with LogEvent(..). We see ESTALE error frequently reported with EVENT trace in fsal_common_is_referral(..) when using test tool like racer. Infact one customer had reported that they see many EVENTs from fsal_common_is_referral(..) frequently for ESTALE error, so as of now have changed LogEvent(..) to LogEventLimited(..) in fsal_common_is_referral(..) for ibm2.7 branch, and would like to make same change in upstream code.\nUsing LogDebug(..) would look fine too over here. Should I change it to LogDebug(..) ?",
      "parentUuid": "078b1b14_dce80c0d",
      "revId": "bb60d38ba540f0291d6c5e65be2964d5d89dd4c5",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "695beaca_30138e54",
        "filename": "src/SAL/state_lock.c",
        "patchSetId": 1
      },
      "lineNbr": 2268,
      "author": {
        "id": 1003571
      },
      "writtenOn": "2020-05-08T15:26:42Z",
      "side": 1,
      "message": "Yes, let\u0027s go with LogDebug.\n\nAnd make sure to add the break below...",
      "parentUuid": "55e64a4a_6aff3d35",
      "revId": "bb60d38ba540f0291d6c5e65be2964d5d89dd4c5",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "967251f9_d0c8428c",
        "filename": "src/SAL/state_lock.c",
        "patchSetId": 1
      },
      "lineNbr": 2271,
      "author": {
        "id": 1003571
      },
      "writtenOn": "2020-05-01T14:29:27Z",
      "side": 1,
      "message": "You probably want a break here.",
      "revId": "bb60d38ba540f0291d6c5e65be2964d5d89dd4c5",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}