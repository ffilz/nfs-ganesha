{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "71dee4ed_904d93de",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1004087
      },
      "writtenOn": "2022-04-25T15:48:23Z",
      "side": 1,
      "message": "It\u0027s not that simple.  The primary purpose of the levels of the cache was that entries in L1 could have a global FD open, and entries in L2 cannot.  Demoting from L1 to L2 was part of tracking and handling the global FDs.  I suspect a more complicated re-design is necessary to achieve the multiple goals that the cache is attempting to fulfill.",
      "revId": "476b93e7cf565b42f65707d6e7fe92cdd5cb1e93",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f6425649_df804135",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1003571
      },
      "writtenOn": "2022-04-25T17:30:47Z",
      "side": 1,
      "message": "Agreed, I think we need to go back to the drawing board.\n\nPreviously, cache_inode had \"pinned\" nodes that were removed from the LRU. Pinned nodes were nodes that were not eligible for reaping because they had state (open, lock, delegation, layout) or were anchors in the pseudofs (export/file system roots, mount points). Going back to removing those nodes from the LRU should mean any node is potentially reapable and then L1/L2 is JUST management of the open fd. We can then look at other changes that might be needed to be more aggressive at reaping if we are over the high water mark.",
      "parentUuid": "71dee4ed_904d93de",
      "revId": "476b93e7cf565b42f65707d6e7fe92cdd5cb1e93",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "879bd995_2aff7410",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1019791
      },
      "writtenOn": "2022-05-04T02:40:48Z",
      "side": 1,
      "message": "Thanks the review. I have a question, \"any node is potentially reapable and then L1/L2 is JUST management of the open fd\", will this cause error or fatal problem? Because whether reap entry from L2, depends on the reference count, so the using entry will not be freed ?",
      "parentUuid": "f6425649_df804135",
      "revId": "476b93e7cf565b42f65707d6e7fe92cdd5cb1e93",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "38bdb8f1_d4fdb27a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1019791
      },
      "writtenOn": "2022-05-09T09:58:51Z",
      "side": 1,
      "message": "Just friendly ping.",
      "parentUuid": "879bd995_2aff7410",
      "revId": "476b93e7cf565b42f65707d6e7fe92cdd5cb1e93",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6fc77886_d18d2c8f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1019791
      },
      "writtenOn": "2022-05-09T09:58:51Z",
      "side": 1,
      "message": "Just a friendly ping.",
      "revId": "476b93e7cf565b42f65707d6e7fe92cdd5cb1e93",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7a5a89a6_088dc0bb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1003571
      },
      "writtenOn": "2022-06-07T17:30:12Z",
      "side": 1,
      "message": "Yes, an entry that has a refcount of 2 or higher will not be freed.",
      "parentUuid": "879bd995_2aff7410",
      "revId": "476b93e7cf565b42f65707d6e7fe92cdd5cb1e93",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c2043c5c_0c205e09",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1003571
      },
      "writtenOn": "2022-06-07T17:30:12Z",
      "side": 1,
      "message": "Apparently I forgot to send my comment...\n\nI am code reviewing this -2 because I think we need more significant work to redo the LRU to exclude objects held for state or pseudofs/export purposes (formerly \"pinned\" in the old cache_inode). This is a more significant effort that will need to be submitted to V5-dev (and then possibly back ported to V4.x).",
      "revId": "476b93e7cf565b42f65707d6e7fe92cdd5cb1e93",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735"
    }
  ]
}